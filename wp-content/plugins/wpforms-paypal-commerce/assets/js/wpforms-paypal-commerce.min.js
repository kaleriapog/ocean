"use strict";var WPFormsPaypalCommerce=window.WPFormsPaypalCommerce||function(s,y){var m,l="",w="",d=!0,f=!1,n=0,_={init:function(){y(_.ready),y(s).on("wpformsReady",_.updateSubmitHandler).on("wpformsProcessConditionalsField",function(e,r,o,n,i){_.processConditionalsPayPalField(r,o,n,i)})},ready:function(){_.bindUIActions(),y(".wpforms-paypal-commerce .wpforms-form").each(function(){_.initPaypalScript(y(this))})},bindUIActions:function(){y(s).on("change",".wpforms-paypal-commerce-payment-method",function(){_.paymentMethodToggle(y(this).closest(".wpforms-form"))}).on("change",".wpforms-paypal-commerce-conditional-trigger input, .wpforms-paypal-commerce-conditional-trigger select",function(){_.checkPaymentsConditionalLogic(y(this).closest(".wpforms-form"))}).on("input",".wpforms-paypal-commerce-conditional-trigger input[type=text], .wpforms-paypal-commerce-conditional-trigger input[type=email], .wpforms-paypal-commerce-conditional-trigger input[type=url], .wpforms-paypal-commerce-conditional-trigger input[type=number], .wpforms-paypal-commerce-conditional-trigger textarea",function(){_.checkPaymentsConditionalLogic(y(this).closest(".wpforms-form"))}).on("wpformsBeforePageChange",_.pageChange)},updateSubmitHandler:function(){void 0!==y.fn.validate&&y(".wpforms-paypal-commerce form.wpforms-validate").each(function(){var e=y(this),r=e.data("validator");if(_.isPaymentsEnabled(e)){if(!r)return!0;m=r.settings.submitHandler,r.settings.submitHandler=_.submitHandler}})},submitHandler:function(e){},processConditionalsPayPalField:function(e,r,o,n){var e=y("#wpforms-form-"+e),i=e.find(".wpforms-field-paypal-commerce");_.isPaymentsEnabled(e)&&i.data("field-id").toString()===r&&(o&&"hide"===n||!o&&"hide"!==n?_.hidePayPalSubmitButtons(e):_.checkPaymentsConditionalLogic(e))},hidePayPalSubmitButtons:function(e){var r=e.data("validator");e.find(".wpforms-paypal-commerce-single-submit-button").addClass("wpforms-hidden"),e.find(".wpforms-paypal-commerce-subscriptions-submit-button").addClass("wpforms-hidden"),e.find(".wpforms-submit").removeClass("wpforms-hidden"),r.settings.submitHandler=m},paymentMethodToggle:function(e){var r=_.isCheckoutSelected(e);e.find(".wpforms-paypal-commerce-payment-method").removeClass("wpforms-hidden"),e.find(".wpforms-paypal-commerce-card-fields").toggleClass("wpforms-hidden",r),e.find(".wpforms-submit").toggleClass("wpforms-hidden",r),e.find(".wpforms-paypal-commerce-single-submit-button").toggleClass("wpforms-hidden",!r)},isCheckoutSelected:function(e){var r=e.find(".wpforms-paypal-commerce-card-fields"),e=e.find(".wpforms-paypal-commerce-payment-method").val();return void 0===e&&!r.length||"checkout"===e},isPaymentsEnabled(e){e=e.data("formid"),e=wpforms_paypal_commerce.payment_options[e];return!(void 0===e||!e.credit_card&&!e.paypal_checkout)},initPaypalScript:function(e){var r=e.data("formid"),r=wpforms_paypal_commerce.payment_options[r];_.isPaymentsEnabled(e)&&(r.enable_recurring&&_.initSubscriptions(e),r.enable_one_time&&_.initSingle(e),_.checkPaymentsConditionalLogic(e))},checkPaymentsConditionalLogic:function(e){var r=e.data("formid"),o=e.find(".wpforms-field-paypal-commerce"),n=o.find(".wpforms-paypal-commerce-payment-method"),i=o.find(".wpforms-paypal-commerce-card-fields"),a=e.data("validator"),t=e.find(".wpforms-paypal-commerce-single-submit-button"),s=e.find(".wpforms-paypal-commerce-subscriptions-submit-button"),p=e.find(".wpforms-submit");_.isPaymentsEnabled(e)&&(o.hasClass("wpforms-conditional-hide")?_.hidePayPalSubmitButtons(e):(a.settings.submitHandler=_.submitHandler,w="",f=!1,_.isSubscriptionsToExecute(r)?(s.removeClass("wpforms-hidden"),o.find(".wpforms-field-description").length?(o.show(),n.addClass("wpforms-hidden"),i.addClass("wpforms-hidden")):o.hide(),t.addClass("wpforms-hidden"),p.addClass("wpforms-hidden")):_.isSingleToExecute(r)?(o.show(),n.removeClass("wpforms-hidden"),_.paymentMethodToggle(e),s.addClass("wpforms-hidden")):(o.hide(),f=!0,_.hidePayPalSubmitButtons(e))))},isSubscriptionsToExecute:function(e){var r=y("#wpforms-form-"+e),o=wpforms_paypal_commerce.payment_options[e];return!!o.paypal_checkout&&(!(!o.enable_recurring||void 0===wpforms_paypal_commerce.conditional_rules[e]||void 0===wpforms_paypal_commerce.conditional_rules[e].recurring||!_.processConditionals(r,wpforms_paypal_commerce.conditional_rules[e].recurring))||(""!==w||o.recurring_no_rules))},isSingleToExecute:function(e){var r=y("#wpforms-form-"+e);return wpforms_paypal_commerce.payment_options[e].enable_one_time&&(void 0===wpforms_paypal_commerce.conditional_rules[e]||void 0===wpforms_paypal_commerce.conditional_rules[e].one_time)||void 0!==wpforms_paypal_commerce.conditional_rules[e]&&void 0!==wpforms_paypal_commerce.conditional_rules[e].one_time&&_.processConditionals(r,wpforms_paypal_commerce.conditional_rules[e].one_time)},initSingle:function(o){var e=o.data("formid"),r=o.find(".wpforms-field-paypal-commerce"),n=o.find(".wpforms-paypal-commerce-credit-card-hidden-input"),r=r.data("field-id"),i=wpforms_paypal_commerce.payment_options[e],a={},t={};"undefined"==typeof wpforms_paypal_single?_.displaySdkError(o):(i.paypal_checkout&&(a.style=_.checkoutStyle(i),a.onClick=function(e,r){return _.onCheckoutClick(o,e,r)},a.createOrder=function(){return _.createSingleOrder(o)},a.onApprove=function(e){_.onCheckoutApprove(o,e)},a.onCancel=function(){_.onCancel(o)},a.onError=function(e){_.onError(o,e)},y(s).trigger("loadPPScript",[e,a]),wpforms_paypal_single.Buttons(a).render("#wpforms-paypal-commerce-single-submit-button-"+e)),i.credit_card&&(t.styles={input:{"font-family":n.css("font-family"),"font-size":n.css("font-size"),"font-weight":n.css("font-weight"),color:"#333"}},t.fields={number:{selector:"#wpforms-"+e+"-field_"+r+"-cardnumber"},cvv:{selector:"#wpforms-"+e+"-field_"+r+"-cardcode",placeholder:"•••"},expirationDate:{selector:"#wpforms-"+e+"-field_"+r+"-carddate"}},t.createOrder=function(){return _.createSingleOrder(o)},_.renderCreditCard(o,t)))},renderCreditCard:function(t,s){var p=t.data("validator"),c=t.find(".wpforms-field-paypal-commerce"),e=t.data("formid"),o=wpforms_paypal_commerce.payment_options[e];wpforms_paypal_single.HostedFields.render(s).then(i=>{var a="";i.on("cardTypeChange",function(e){var r;a="",void 0!==e.cards[0]&&1===e.cards.length&&(r=e.cards[0].type,o.supported_cards.includes(r)||(a=e.cards[0].niceType+" "+wpforms_paypal_commerce.i18n.card_not_supported,_.onFieldError(t,s.fields.number.selector,a)))}),i.on("focus",function(e){e=e.emittedBy;t.find(s.fields[e].selector).parent().find(".wpforms-error").remove()}),t.find(".wpforms-submit, .wpforms-page-button").on("click",function(e){if(c.hasClass("wpforms-conditional-hide")||f)p.settings.submitHandler=m;else{var r=i.getState();if(!c.find(".wpforms-field-paypal-commerce-name input").hasClass("wpforms-field-required")&&r.fields.number.isEmpty&&r.fields.expirationDate.isEmpty&&r.fields.cvv.isEmpty)p.settings.submitHandler=m;else{if(y(this).hasClass("wpforms-page-button")){var o=y(this).closest(".wpforms-page").find(".wpforms-paypal-commerce-card-fields");if(!o.length||!o.is(":visible"))return;d=!0}if(e.preventDefault(),Object.keys(r.fields).every(function(e){return r.fields[e].isValid}))a?_.onFieldError(t,s.fields.number.selector,a):y(this).hasClass("wpforms-submit")&&t.validate().form()&&(t.find(".wpforms-submit-spinner").show(),t.find(".wpforms-submit").prop("disabled",!0),i.submit({cardholderName:t.find(".wpforms-field-paypal-commerce-cardname").val(),contingencies:["SCA_WHEN_REQUIRED"]}).then(function(e){e.liabilityShift&&"POSSIBLE"!==e.liabilityShift?_.onError(t,wpforms_paypal_commerce.i18n.secure_error):(t.find(".wpforms-paypal-commerce-order-id").val(l),m(t))}).catch(e=>{t.find(".wpforms-submit-spinner").hide(),t.find(".wpforms-submit").prop("disabled",!1),_.onError(t,e)}));else for(var n of Object.keys(r.fields))r.fields[n].isValid||(_.onFieldError(t,s.fields[n].selector,wpforms_paypal_commerce.i18n[n]),d=!1)}}})})},initSubscriptions:function(o){var e=o.data("formid"),r=wpforms_paypal_commerce.payment_options[e],n={};r.paypal_checkout&&("undefined"==typeof wpforms_paypal_subscriptions?_.displaySdkError(o):(n.style=_.checkoutStyle(r),n.onClick=function(e,r){return _.onCheckoutClick(o,e,r)},n.createSubscription=function(){return _.createSubscription(o)},n.onApprove=function(e){_.approveSubscription(o,e)},n.onCancel=function(){_.onCancel(o)},n.onError=function(){_.onError(o,wpforms_paypal_commerce.i18n.subscription_error)},wpforms_paypal_subscriptions.Buttons(n).render("#wpforms-paypal-commerce-subscriptions-submit-button-"+e)))},checkoutStyle:function(e){return{color:e.color,shape:e.shape}},onCheckoutClick:function(e,r,o){return e.find(".wpforms-paypal-commerce-error").remove(),e.validate().form()?o.resolve():o.reject()},onCancel:function(e){var r=s.createElement("div");r.classList.add("wpforms-error-container"),r.classList.add("wpforms-paypal-commerce-error"),r.innerHTML=wpforms_paypal_commerce.i18n.on_cancel,e.find(".wpforms-submit").before(r.cloneNode(!0))},onError:function(e,r){var o=e.find(".wpforms-paypal-commerce-error"),n=wpforms_paypal_commerce.i18n.on_error;wpforms.amountTotalCalc(e)?"string"==typeof r?n=r:void 0!==r.details&&void 0!==r.details[0].issue?n=wpforms_paypal_commerce.i18n.api_error+" "+r.details[0].issue+"<br>"+n:void 0!==r.name&&"INVALID"!==r.name&&(n=wpforms_paypal_commerce.i18n.api_error+" "+r.name+"<br>"+n):n=wpforms_paypal_commerce.i18n.empty_amount,o.length?o.html(n):((o=s.createElement("div")).classList.add("wpforms-error-container"),o.classList.add("wpforms-paypal-commerce-error"),o.innerHTML=n,e.find(".wpforms-submit").before(o.cloneNode(!0)))},onFieldError:function(e,r,o){var n=e.find(r).parent().find(".wpforms-error"),o=void 0===o.message?o:o.message;n.length?n.html(o):((n=s.createElement("label")).classList.add("wpforms-error"),n.innerHTML=o,e.find(r).after(n.cloneNode(!0)))},displaySdkError:function(e){e.find(".wpforms-field-paypal-commerce").append(y("<label></label>",{text:wpforms_paypal_commerce.i18n.missing_sdk_script,class:"wpforms-error"}))},createSingleOrder:function(e){var r=new FormData(e.get(0));return r.append("total",wpforms.amountTotalCalc(e)),r.append("nonce",wpforms_paypal_commerce.nonces.create),fetch(wpforms_settings.ajaxurl+"?action=wpforms_paypal_commerce_create_order",{method:"POST",body:r}).then(function(e){return e.json()}).then(function(e){return l=e.data.id,e.data.id})},onCheckoutApprove:function(e,r){e.find(".wpforms-paypal-commerce-source").val(r.paymentSource),e.find(".wpforms-paypal-commerce-order-id").val(r.orderID),e.find(".wpforms-submit-spinner").remove(),e.find(".wpforms-paypal-commerce-single-spinner").show(),m(e)},createSubscription:function(e){var r=new FormData(e.get(0));return r.append("total",wpforms.amountTotalCalc(e)),r.append("planId",w),r.append("nonce",wpforms_paypal_commerce.nonces.create_subscription),fetch(wpforms_settings.ajaxurl+"?action=wpforms_paypal_commerce_create_subscription",{method:"POST",body:r}).then(function(e){return e.json()}).then(function(e){return e.data.id})},approveSubscription:function(e,r){e.find(".wpforms-paypal-commerce-source").val(r.paymentSource),e.find(".wpforms-paypal-commerce-subscription-id").val(r.subscriptionID),e.find(".wpforms-submit-spinner").remove(),e.find(".wpforms-paypal-commerce-recurring-spinner").show(),m(e)},pageChange:function(e,r,o){d||_.isCheckoutSelected(o)||n&&n!==r||(n=r,e.preventDefault())},processConditionals:function(e,r){if(!r.length)return!1;for(var o in r){var n,i=r[o].logic,a=r[o].action,t=!1;for(n in i.length||(t=!0),i)if(i.hasOwnProperty(n)){var s,p=i[n],c=!0;for(s in p)if(p.hasOwnProperty(s)){var m,l=p[s],d="",f=!1,u="";if(l.field){switch(null===(d=wpformsconditionals.getElementValueByRule(l,e))&&(d=""),u=y.trim(d).toString().toLowerCase(),m=y.trim(l.value).toString().toLowerCase(),l.operator){case"==":f=u===m;break;case"!=":f=u!==m;break;case"c":f=-1<u.indexOf(m)&&0<u.length;break;case"!c":f=-1===u.indexOf(m)&&0<m.length;break;case"^":f=0===u.lastIndexOf(m,0);break;case"~":f=-1!==u.indexOf(m,u.length-m.length);break;case"e":f=0===u.length;break;case"!e":f=0<u.length;break;case">":f=""!==(u=u.replace(/[^-0-9.]/g,""))&&_.floatval(u)>_.floatval(m);break;case"<":f=""!==(u=u.replace(/[^-0-9.]/g,""))&&_.floatval(u)<_.floatval(m)}if(!f){c=!1;break}}}if(c){t=!0;break}}if(t&&"go"===a)return w=o,t}return t}};return _}(document,(window,jQuery));WPFormsPaypalCommerce.init();